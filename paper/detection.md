# Method to Identify and Score Darts thrown into Dartboard

http://web.stanford.edu/class/ee368/Project_Autumn_1516/Reports/Delaney.pdf

## Abstract—
The author examines the problem of scoring a game of darts by use of image processing techniques. Dart enthusiast today are forced to choose between playing on regulation equipment and manually keeping score, or to use inferior, nonregulation, electronic dartboards. This paper presents a novel method of using images gathered from a stationary camera to automatically segment the board into each scoring region, then identify the position of darts thrown into the board.
Index Terms—Image processing, darts, unsupervised segmentation, straight line detection, color morphological processing, foreground detection.

著者は、画像処理技術を利用してダーツのゲームのスコアの問題を検討しています。今日のダーツ愛好家は、レギュレーション機器でプレイして手動でスコアを維持するか、または劣った非レギュレーションの電子ダーツボードを使用するかの選択を余儀なくされている。本論文では，固定カメラから収集した画像を用いて，ボードを自動的に各スコア領域に分割し，ボードに投げ込まれたダーツの位置を特定する新しい方法を紹介する．
索引用語-画像処理，ダーツ，教師なしセグメンテーション，直線検出，カラーモーフォロジー処理，前景検出．

## I. INTRODUCTION
The game of darts is a throwing sport in which participants toss projectiles into a circular target attached to a vertical surface. The target is divided into many regions which correspond to different point and multiplier values. Darts is commonly played across North America and Europe and is a popular past time for many so an application that allows players to more conveniently keep score would be widely beneficial. “Darts” is a general term for a targeting game following this basic premise and many game variations exist within this archetype; all utilizing the standard dart projectiles with a regulation dart board. Each game variant may have different objectives for which players to aim but identifying the region in which the dart has hit in the dartboard is necessary for proper scoring. This paper proposes the use of image processing to identify thrown darts and to detect which scoring region of the dartboard the dart has struck. The method outlined within takes images from a stationary mounted camera as inputs. First an image of the dart board with no darts is used to determine point regions, then additional images of darts within the board are processed to provide an output that concludes which player threw the dart and the point value of the thrown dart.

ダーツのゲームは、参加者が垂直面に取り付けられた円形のターゲットに投射物を投げるスポーツです。ターゲットは、異なるポイントと乗数値に対応する多くの領域に分かれています。ダーツは一般的に北米やヨーロッパでプレイされており、プレイヤーがより便利にスコアを維持することができますアプリケーションは、広く有益であろうので、多くの人に人気の過去の時間です。"ダーツ "は、この基本的な前提と多くのゲームのバリエーションは、このアーキタイプ内に存在し、すべての規制ダーツボードと標準的なダーツの投射物を利用しています。各ゲームのバリエーションは、プレイヤーが目指すための異なる目的を持っているかもしれませんが、ダーツがダーツボードにヒットした領域を識別することは、適切なスコアリングのために必要である。本稿では、投げられたダーツを識別し、ダーツが打ったダーツボードのどのスコアリング領域を検出するために画像処理の使用を提案します。内で概説された方法は、入力として固定マウントされたカメラからの画像を取ります。最初にダーツのないダーツボードの画像がポイント領域を決定するために使用され、その後、ボード内のダーツの追加の画像は、どのプレイヤーがダーツを投げたかと投げられたダーツのポイント値を結論づける出力を提供するために処理されています。

## II. RELATED WORK
Electronic dartboards that automatically keep score using sensors built into the board itself are widely available. These types of boards are generally not preferred by dart enthusiast, however, due to the necessity to use plastic hardware that is prone to break and has a perceived ‘amateur’ feel. There is no known work directly related to the specific task of identifying and localizing darts using image processing. Though, there has been extensive research in the areas of color morphological processing, region detection, foreground detection, and adaptive thresholding; the results of which are used to achieve the goals of this project.

自動的にボード自体に組み込まれたセンサーを使用してスコアを維持する電子ダーツボードは広く利用可能です。ボードのこれらのタイプは、一般的に壊れやすいと認識された "アマチュア "の感触を持っているプラスチック製のハードウェアを使用する必要性のために、しかし、ダーツ愛好家によって好まれていません。画像処理を使用してダーツを識別し、ローカライズする特定のタスクに直接関連する既知の作業はありません。しかし、色の形態学的処理、領域検出、前景検出、適応的しきい値化の分野では広範な研究が行われており、その結果は本プロジェクトの目的を達成するために使用されています。

## III. TECHICAL APPROACH
A standard dartboard is circular in shape and divided radially into twenty sections, alternating in color between light and dark spaces, which each represent a separate point value, with two concentric circles in the center known as the bullseye. Additionally, the board contains two outer rings, alternating between green and red spaces, which subdivide each scoring section into single, double, and triple point value areas, Fig 1. Keeping accurate score requires that the image processing approach can correctly determine both the location that the dart lands on the board and the point value of that region of the board.  The approach used in this project is divided into two main tasks: region segmentation to assign a point value to each pixel in the image, and dart localization to locate the dart in the image and determine the pixels that correspond to where the dart tip contacts the board. The following two subsections describe the methodology used to accomplish each of these objectives.

標準的なダーツボードは、形状が円形であり、それぞれがブルズアイとして知られている中央の2つの同心円で、別々のポイント値を表す光と暗いスペースの間の色で交互に、20のセクションに放射状に分割されています。さらに、ボードには、緑と赤のスペースを交互に配置した2つの外輪があり、それぞれのスコアリング・セクションを1つ、2つ、3つのポイントバリュー・エリアに細分化しています（図1）。正確なスコアを維持するためには、画像処理アプローチが、ダーツがボード上に着地する位置とボードのその領域のポイント値の両方を正確に決定できることが必要です。 このプロジェクトで使用されるアプローチは、画像内の各ピクセルにポイント値を割り当てる領域分割と、画像内のダーツの位置を特定し、ダーツの先端が基板に接触する場所に対応するピクセルを決定するダーツ局在化の2つの主要なタスクに分かれています。以下の2つのサブセクションでは、これらの目的を達成するために使用される方法論について説明します。

### A. Region Segmentation
The board region segmentation process is performed on a background image, Bx,y, of the dart board before play begins. This section examines the processes implemented to identify multiplier regions based on color morphological processing, and the radial dividers based on straight line detection algorithms. 

ボード領域分割処理は、プレイ開始前のダーツボードの背景画像Ｂｘ，ｙに対して実行される。ここでは、カラーモーフォロジー処理に基づいて乗算領域を特定するために実装された処理と、直線検出アルゴリズムに基づいて放射状に分割された乗算領域を特定するために実装された処理について検討する。

We begin by converting Bx,y to grayscale and thresholding using Otsu’s method [1]. The resulting black and white image is used to crop Bx,y to remove superfluous background pixels and decrease processing time. Next, we use the known color regions of a standard dartboard to create a pixel mask of the dart board point multiplier regions. First, with the knowledge that the double and triple rings consist exclusively of alternating red and Fig. 1. Regulation Dart Board green areas, we are able to take the intensity of the red and green channels of Bx,y, subtract the grayscale background image to eliminate the white pixels, and threshold again using Otsu’s method, to obtain red and green pixel masks. A pixel-by-pixel logical OR of these two masks results in a mask that contains all double and triple multiplier regions, as well as the bullseye regions in the center, Fig. 2.

まず、Bx,yをグレースケールに変換し、大津の手法[1]を用いて閾値処理を行う。得られた白黒画像を用いて、余計な背景画素を除去し、処理時間を短縮するために、Bx,yをクロップする。次に、標準的なダーツボードの既知の色領域を用いて、ダーツボードの点乗領域の画素マスクを作成する。まず、二重リングと三重リングが赤と図１の交互の領域のみで構成されているという知識をもって 規制ダーツボードの緑の領域は、Ｂｘ，ｙの赤と緑のチャンネルの強度を取り、グレースケールの背景画像を減算して白の画素を除去し、大津の方法を用いて再度閾値処理を行い、赤と緑の画素マスクを得ることができる。これら2つのマスクをピクセル単位で論理和することで、2倍乗算領域と3倍乗算領域のすべてと、中央のブルズアイ領域を含むマスクが得られる（図2）。

All of the multiplier regions can now be derived from the combination of the red and green pixel masks. First, the binary image in Fig. 2 is ‘closed’ by dilating and subsequently eroding by a structural element calculated to be roughly the size of the wire dividers. This process removes the spaces dividing the red and green masks and creates continuous rings. Next, the holes are filled inside the resulting continuous rings to create a binary map of the entire scoring area. The inverse of this region (outside of the scoring area) constitutes the zero multiplier region, Fig. 3(a), in which all darts count for zero points.

これで、すべての乗算領域は、赤と緑の画素マスクの組み合わせから導き出すことができるようになりました。最初に、図２の２値画像は、ワイヤの分割線の大きさとほぼ同じ大きさになるように計算された構造要素によって、拡張とその後の浸食によって「閉じた」状態になります。この処理により、赤と緑のマスクを仕切る空間が除去され、連続したリングが形成される。次に、得られた連続リングの内側に穴を埋めて、採点領域全体の二値マップを作成します。この領域の逆数（採点領域の外側）は、図３（ａ）に示すように、すべてのダーツが０点としてカウントされるゼロ乗数領域を構成している。

The single multiplier region, Fig. 3(b), is then found by subtracting the red and green masks from the scoring region because it is known that the single region consists only of light and dark regions. Next, the double multiplier region, Fig. 3(c), is established by filling the holes in the single region and subtracting from the entire scoring region. Similar manipulation of the board region masks are then used to determine the triple, outer bullseye, and inner bullseye regions – shown in Fig. 3(d), Fig. 3(e), and Fig. 3(f), respectively.

次に、単一の乗数領域である図３（ｂ）は、単一の領域が明部と暗部のみからなることが知られているため、採点領域から赤と緑のマスクを差し引くことで求められる。次に、単一領域の穴を埋め、採点領域全体から減算することにより、二重乗算領域である図３（ｃ）が成立する。次に、盤面領域マスクを同様に操作して、トリプル領域、アウターブルズアイ領域、インナーブルズアイ領域、すなわち図３（ｄ）、図３（ｅ）、図３（ｆ）にそれぞれ示すような領域を決定する。

With all the multiplier regions now known, the next task is to segment the board based on the metal radial dividers to assign point values for each slice of the board. A Canny edge detection operator [2] is used on the grayscale conversion of the background image, Bx,y, to create a black and white image of the strongest edges. The Standard Hough Transform [3][4] of the binary edge map is then computed and the ten greatest peaks are determined, Fig. 4. These peak angles correspond to the angle of the metal dividing bars that bisect the board, Fig. 5. Using the dart board’s standard numbering pattern, a point value is determined for pixels that fall within each straight line angle. With the information gathered from the multiplier regions and the straight line angles, we can derive an algorithm that relates every pixel on the background image to a point value.

これですべての乗算領域がわかったので、次の課題は、金属の半径方向の分割器に基づいて基板をセグメント化し、基板の各スライスに点の値を割り当てることです。背景画像Bx,yのグレースケール変換にCannyエッジ検出演算子[2]を使用して、最も強いエッジの白黒画像を作成します。次に、二値エッジマップの標準ハフ変換[3][4]が計算され、10個の最大のピークが決定される（図4）。これらのピークの角度は、ボードを二分する金属製の分割バーの角度に対応しています（図5）。ダーツボードの標準的なナンバリングパターンを使用して、各直線の角度内にあるピクセルのポイント値が決定されます。乗算領域と直線角度から得られた情報をもとに、背景画像上のすべての画素を点値に関連付けるアルゴリズムを導出することができる。

### B. Determining Dart Location
Once the background image is processed to create a point map, gameplay can begin. After each dart is thrown, the stationary camera takes another image, Ix,y, of the dart within the dartboard and the image processing technique attempts to discern the location of the dart and which player the dart belongs to. This process begins by optionally using a SIFT match technique to match features of Ix,y and Bx,y and find the transform matrix to perform a Homographic transpose to better match the two images. This process is used to account for small movements in the camera between the times the two images are taken.

背景画像がポイントマップを作成するために処理されると、ゲームプレイを開始することができます。各ダーツが投げられた後、静止したカメラは、ダーツボード内のダーツの別の画像、Ix,yを撮影し、画像処理技術は、ダーツの位置とダーツがどのプレイヤーのものであるかを識別しようとします。この処理は、Ix,yとBx,yの特徴を一致させ、2つの画像をより良く一致させるためにホモグラフィック転置を実行するための変換行列を見つけるために、オプションでSIFTマッチ技術を使用することから始まる。このプロセスは、2つの画像が撮影された時間の間のカメラの小さな動きを考慮するために使用されます。

With the two images now aligned, each image is filtered with a Gaussian kernel to smooth out sharp transitions such as light glares. Then an image difference technique is used to detect the dart in the foreground [5]. An adaptive difference equation is used because taking the absolute difference results in intensity variations between the regions light and dark patterns on the background image, which make global thresholding difficult. The algorithm used normalizes the difference of the dark regions and the light regions separately then combines the result to form a grayscale image of dart in the foreground, Fig. 6. 

2枚の画像が揃ったので、各画像はガウスカーネルでフィルタリングされ、光の眩しさなどのシャープな遷移を滑らかにします。次に，前景のダーツを検出するために画像差分法が使用されます [5]．差分の絶対値を取ると背景画像の明暗パターン間で強度のばらつきが生じ、大域的なしきい値化が困難になるため、適応差分式を用いている。このアルゴリズムでは、暗部と明部の差を別々に正規化し、その結果を合成して、前景のダーツのグレースケール画像（図 6）を生成する。  

This grayscale image is the converted to a binary image by thresholding using Otsu’s method to create a binary mask of the  dart. This dart mask is dilated using a round structural element to adjoin any segmented regions, followed by calculation of the orientation [6] to determine the primary angle that the dart entered the board. Next, the original dart mask is ‘closed’ by dilating and subsequently eroding by a straight line structural element rotated based on the orientation of the dart. This results in the final foreground image that we use to determine the pixel location of the dart tip, based on the extreme value along the angle of orientation. This pixel location is compared to the point map to determine the point value of each dart throw.

このグレースケール画像を大津の手法を用いて閾値処理して２値画像に変換し、ダーツの２値マスクを作成する。このダーツマスクは、任意の分割領域を隣接させるために丸い構造要素を用いて希釈され、次いで、ダーツが基板に入った一次角度を決定するために、方位[6]を計算する。次に、元のダーツマスクは、ダーツの向きに基づいて回転された直線構造要素によって希釈され、続いて浸食されることによって「閉じられ」ます。この結果、最終的な前景画像が得られ、これを用いて、方位角に沿った極端な値に基づいて、ダーツ先端のピクセル位置を決定する。このピクセル位置をポイントマップと比較して、各ダーツの投球のポイント値を決定します。

The final task is to determine which player’s dart is in the image, Ix,y. In this project, the darts were color coded to improve the foreground detection accuracy and assist in dart recognition. Therefore, the player can discerned based on a comparison of color channel values. Sample results using this technical approach are shown in Fig. 7.

最終的なタスクは、画像内のどのプレイヤーのダーツが画像内にあるか、Ix,yを決定することである。このプロジェクトでは、前景検出精度を向上させ、ダーツ認識を支援するために、ダーツを色分けした。したがって、カラーチャンネル値の比較に基づいてプレーヤを識別することができる。この技術的アプローチを用いたサンプル結果を図７に示す。

### IV. EXPRIMENTAL RESULTS
Test images were gathered from a stationary camera that was adjustable to capture images at different viewing angles. Several simulated dart throw images were captured intended to test all regions of the board from each angle. The methodology proposed in the paper was developed and tested in MATLAB. The effectiveness of the point map algorithm and the accuracy of the dart location algorithm were evaluated. 

テスト画像は、異なる視野角で画像をキャプチャするために調整可能な固定カメラから収集されました。いくつかのシミュレートされたダーツ投げ画像は、各角度からボードのすべての領域をテストすることを意図してキャプチャされました。論文で提案された方法論は、MATLABで開発され、テストされました。ポイントマップアルゴリズムの有効性とダーツ位置アルゴリズムの精度を評価した。

The point map accuracy was tested by running each background test image through the developed MATLAB script and hand detecting the error regions using the MATLAB roipoly function. Since this technology is ultimately intended to be used in a real time system, accuracy and speed are key benchmarks. Table 1 shows that the region detection algorithm is consistently very accurate when the camera is mounted from a narrow viewing angle but quickly miscalculates images from very wide angles. The time scales nearly linearly with image size. Therefore, in practice, the image resolution could be decreased to increase computation time without greatly decreasing the accuracy.

ポイントマップの精度は、開発されたＭＡＴＬＡＢスクリプトを介して各背景テスト画像を実行し、ＭＡＴＬＡＢのｒｏｉｐｏｌｙ関数を用いてエラー領域を手で検出することによってテストされた。この技術は最終的にリアルタイムシステムでの使用を意図しているため、精度と速度が重要なベンチマークとなっています。表1に示すように、カメラが狭い視野角から取り付けられている場合、領域検出アルゴリズムは一貫して非常に正確ですが、非常に広い視野角からの画像はすぐに誤算してしまいます。時間のスケールは画像サイズにほぼ比例しています。したがって、実際には、精度を大幅に低下させることなく計算時間を増加させるために画像解像度を下げることができます。

The effectiveness of the dart location procedure was tested by running each dart image and its respective background image through the dart detection algorithm and comparing the generated hitpoint pixel coordinates to the actual pixel coordinates that were manually determined by inspection of the image. The difference between the actual and tested pixel coordinates for viewing angles of 45° and 60° are shown in Graph 1, results from the 30° viewing angle were very erratic and excluded from this plot. This is due to the algorithm not being able to detect accurate dart orientation from such a straight-on observation point. It can be seen that from a moderately narrow viewing angle the method is highly precise but for wider viewing angles, the precision drops considerably. Test data shows that for a 45° viewing angle the average displacement from the origin is only 13.17 pixels for a native 3024x4032 resolution image, excluding outliers from not properly segmenting the foreground.

ダーツ検出アルゴリズムを通して各ダーツ画像とその背景画像を実行し、生成されたヒットポイントピクセル座標を画像の検査によって手動で決定された実際のピクセル座標と比較することによって、ダーツ位置検出手順の有効性がテストされました。視野角45°と60°の実際のピクセル座標とテストされたピクセル座標の差をグラフ1に示しますが、視野角30°の結果は非常に不規則で、このプロットからは除外されています。これは、アルゴリズムがこのような直進観測点から正確なダーツの向きを検出できなかったためである。中程度の狭い視野角では、この方法は非常に正確ですが、より広い視野角では精度がかなり低下することがわかります。テストデータによると、視野角45°の場合、前景を適切にセグメント化していないことによる外れ値を除くと、3024x4032の解像度のネイティブ画像では、原点からの平均変位はわずか13.17ピクセルであることがわかりました。

The results obtained using this technique provide a good proof of concept for digitalizing dart scoring while maintaining the use of regulation equipment. The proposed method was able to localize darts to within a few pixels of their actual position and report the points scored. Further work includes porting this MATLAB model to take advantage of modern DSPs in order to speed up processing time. Also, additional work in areas such as multiple dart detection and foreground recognition is suggested in order to increase the accuracy and precision of the dart localization and to make this method practical in real-world use. Furthermore, this paper provides only an intuition for the best camera viewing angle. Further research is necessary to find the optimal offset angle for the stationary camera.

この手法を用いて得られた結果は、規制機器の使用を維持しながらダーツスコアリングをデジタル化するための良い概念の証明となる。提案された方法は、ダーツを実際の位置から数ピクセル以内に定位させ、スコアされたポイントを報告することができました。今後は、処理時間を短縮するために、このMATLABモデルを最新のDSPを利用するために移植することも含まれています。また、複数のダーツの検出や前景認識などの分野でも、ダーツ定位の精度と精度を向上させ、この手法を実世界で実用的なものにするための追加的な作業が提案されています。また、本稿では、最適なカメラ視野角についての直感的な情報を提供しているにすぎない。また，固定カメラに最適なオフセット角度を求めるためには，今後の研究が必要である．